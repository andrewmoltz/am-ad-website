<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.M. | A.D.</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: white;
            color: black;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            perspective: 1000px;
        }
        
        #content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            line-height: 1.8;
            font-size: 18px;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }
        
        #content p {
            margin-bottom: 0.5em;
        }
        
        .italic {
            font-style: italic;
        }
        
        span#emailLink {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        span#emailLink:hover {
            text-decoration: underline;
        }
        
        .letter {
            display: inline-block;
        }
    </style>
</head>
<body>

    <div id="content">
        <p id="line1">A.M. | A.D.</p>
        <p id="line2" class="italic" style="cursor: pointer;">Everywhere, U.S.A.</p>
        <p id="line3"><span id="emailLink" style="cursor: pointer;">E-Mail</span></p>
    </div>

    <script>
        const content = document.getElementById('content');
        const emailLink = document.getElementById('emailLink');
        let emailReveal = null;
        const locationLine = document.getElementById('line2');
        let isDragging = false;
        let hasClicked = false;
        let currentRotateX = 0;
        let currentRotateY = 0;
        let locationClicked = false;
        
        // 3D rotation functionality
        document.addEventListener('mousedown', (e) => {
            if (e.target === locationLine && !locationClicked) {
                // Don't start dragging, let the location click handler work
                return;
            } else if (e.target !== emailLink && !hasClicked) {
                isDragging = true;
            } else if (hasClicked) {
                isDragging = true;
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                const deltaX = e.clientX - centerX;
                const deltaY = e.clientY - centerY;
                
                currentRotateY = (deltaX / centerX) * 180;
                currentRotateX = -(deltaY / centerY) * 180;
                
                if (!hasClicked) {
                    content.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
                } else {
                    emailReveal.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
                }
            }
        });
        
        document.addEventListener('touchstart', (e) => {
            if (e.target !== emailLink && !hasClicked) {
                isDragging = true;
            } else if (hasClicked) {
                isDragging = true;
            }
        });
        
        document.addEventListener('touchend', () => {
            isDragging = false;
        });
        
        document.addEventListener('touchmove', (e) => {
            if (isDragging) {
                const touch = e.touches[0];
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                const deltaX = touch.clientX - centerX;
                const deltaY = touch.clientY - centerY;
                
                currentRotateY = (deltaX / centerX) * 180;
                currentRotateX = -(deltaY / centerY) * 180;
                
                if (!hasClicked) {
                    content.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
                } else {
                    emailReveal.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
                }
            }
        });
        
        // Falling letters animation on email click
        function splitIntoLetters(element) {
            const text = element.textContent;
            element.innerHTML = '';
            
            for (let char of text) {
                const span = document.createElement('span');
                span.className = 'letter';
                span.textContent = char;
                if (char === ' ') {
                    span.style.width = '0.3em';
                }
                element.appendChild(span);
            }
        }
        
        function emailClickHandler(e) {
            if (hasClicked) return;
            hasClicked = true;
            
            // Create email reveal element dynamically
            if (!emailReveal) {
                emailReveal = document.createElement('a');
                emailReveal.href = 'mailto:andrew@am-ad.com';
                emailReveal.textContent = 'andrew@am-ad.com';
                emailReveal.style.position = 'fixed';
                emailReveal.style.top = '50%';
                emailReveal.style.left = '50%';
                emailReveal.style.fontSize = '18px';
                emailReveal.style.fontFamily = 'Times New Roman, Times, serif';
                emailReveal.style.lineHeight = '1.8';
                emailReveal.style.opacity = '0';
                emailReveal.style.zIndex = '9999';
                emailReveal.style.cursor = 'pointer';
                emailReveal.style.transformStyle = 'preserve-3d';
                emailReveal.style.transition = 'transform 0.1s ease-out';
                emailReveal.style.color = 'black';
                emailReveal.style.textDecoration = 'none';
                document.body.appendChild(emailReveal);
            }
            
            // Position email at center with same transform as content
            emailReveal.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
            emailReveal.style.transformOrigin = 'center center';
            
            // Split all text into individual letters
            const lines = Array.from(content.querySelectorAll('p'));
            
            lines.forEach(splitIntoLetters);
            
            // Get all letters
            const allLetters = document.querySelectorAll('.letter');
            
            // Wait for line2 letters to start falling before revealing email
            const middleLine = lines[Math.floor(lines.length / 2)];
            const middleLineLetters = middleLine.querySelectorAll('.letter');
            const line2StartDelay = Array.from(allLetters).indexOf(middleLineLetters[0]) * 30;
            
            setTimeout(() => {
                emailReveal.style.transition = 'opacity 0.8s ease-out';
                emailReveal.style.opacity = '1';
            }, line2StartDelay + 100);
            
            // Create clones and animate them
            allLetters.forEach((letter, index) => {
                setTimeout(() => {
                    const rect = letter.getBoundingClientRect();
                    
                    // Get the computed transform to account for 3D rotation
                    const computedStyle = window.getComputedStyle(letter);
                    const transform = computedStyle.transform;
                    
                    const startX = rect.left + rect.width / 2; // Center of letter
                    const startY = rect.top + rect.height / 2; // Center of letter
                    
                    // Create a clone outside the transformed parent
                    const clone = document.createElement('div');
                    clone.textContent = letter.textContent;
                    clone.style.position = 'fixed';
                    clone.style.left = startX + 'px';
                    clone.style.top = startY + 'px';
                    clone.style.transform = 'translate(-50%, -50%)'; // Center the clone
                    clone.style.fontFamily = 'Times New Roman, Times, serif';
                    clone.style.fontSize = '18px';
                    clone.style.pointerEvents = 'none';
                    clone.style.zIndex = '1';
                    if (letter.parentElement.classList.contains('italic')) {
                        clone.style.fontStyle = 'italic';
                    }
                    
                    document.body.appendChild(clone);
                    
                    // Hide original
                    letter.style.opacity = '0';
                    
                    // Random physics values
                    const randomXVelocity = (Math.random() - 0.5) * 3;
                    const randomRotation = (Math.random() - 0.5) * 10;
                    
                    let posX = startX;
                    let posY = startY;
                    let velocityY = 0;
                    let velocityX = randomXVelocity;
                    let rotation = 0;
                    const gravity = 0.3;
                    
                    // Apply the current 3D rotation to the falling letter
                    const baseTransform = `rotateX(${currentRotateX}deg) rotateY(${currentRotateY}deg)`;
                    
                    function animate() {
                        velocityY += gravity;
                        posY += velocityY;
                        posX += velocityX;
                        rotation += randomRotation;
                        
                        clone.style.left = posX + 'px';
                        clone.style.top = posY + 'px';
                        clone.style.transform = `${baseTransform} translate(-50%, -50%) rotate(${rotation}deg)`;
                        
                        if (posY < window.innerHeight + 100) {
                            requestAnimationFrame(animate);
                        }
                    }
                    
                    animate();
                }, index * 30);
            });
        }
        
        // Attach initial email click handler
        emailLink.addEventListener('click', emailClickHandler);
        
        // Location detection on click
        locationLine.addEventListener('click', async (e) => {
            if (locationClicked || hasClicked) return;
            locationClicked = true;
            
            // Hide all other text and show only "Locating..."
            document.getElementById('line1').style.opacity = '0';
            document.getElementById('line3').style.opacity = '0';
            
            const originalText = locationLine.textContent;
            locationLine.textContent = 'Locating...';
            locationLine.style.fontStyle = 'normal';
            
            try {
                // Try multiple geolocation services
                let data = null;
                const startTime = Date.now();
                const minLoadingTime = 1500; // 1.5 seconds minimum
                
                // First try: ip-api.com (free, no key needed, CORS friendly)
                try {
                    const response = await fetch('http://ip-api.com/json/');
                    data = await response.json();
                    
                    if (data.status === 'success' && data.city && data.regionName) {
                        // Calculate remaining time to reach minimum loading time
                        const elapsed = Date.now() - startTime;
                        const remainingTime = Math.max(0, minLoadingTime - elapsed);
                        
                        // Wait for remaining time before showing results
                        await new Promise(resolve => setTimeout(resolve, remainingTime));
                        
                        // Clear the content div and create new structure
                        content.innerHTML = '';
                        
                        // Create coordinates line
                        const coordsLine = document.createElement('p');
                        coordsLine.textContent = `${data.lat.toFixed(4)}째N, ${data.lon.toFixed(4)}째W`;
                        coordsLine.style.opacity = '0';
                        coordsLine.style.transition = 'opacity 1s ease-in';
                        content.appendChild(coordsLine);
                        
                        // Create city/state line
                        const cityLine = document.createElement('p');
                        cityLine.className = 'italic';
                        cityLine.textContent = `${data.city}, ${data.regionName}`;
                        cityLine.style.opacity = '0';
                        cityLine.style.transition = 'opacity 1s ease-in';
                        cityLine.style.transitionDelay = '0.3s';
                        content.appendChild(cityLine);
                        
                        // Create email line
                        const newEmailLine = document.createElement('p');
                        const newEmailLink = document.createElement('span');
                        newEmailLink.id = 'emailLink';
                        newEmailLink.textContent = 'E-Mail';
                        newEmailLink.style.cursor = 'pointer';
                        newEmailLink.style.opacity = '0';
                        newEmailLink.style.transition = 'opacity 1s ease-in';
                        newEmailLink.style.transitionDelay = '0.6s';
                        newEmailLine.appendChild(newEmailLink);
                        content.appendChild(newEmailLine);
                        
                        // Trigger fade in
                        setTimeout(() => {
                            coordsLine.style.opacity = '1';
                            cityLine.style.opacity = '1';
                            newEmailLink.style.opacity = '1';
                        }, 100);
                        
                        // Re-attach email click handler to new element
                        newEmailLink.addEventListener('click', emailClickHandler);
                        
                        // Reset location clicked for potential future interactions
                        locationClicked = false;
                        return;
                    }
                } catch (e) {
                    console.log('ip-api failed, trying backup...');
                }
                
                // Backup: ipapi.co
                try {
                    const response = await fetch('https://ipapi.co/json/');
                    data = await response.json();
                    
                    if (data.city && data.region && data.latitude && data.longitude) {
                        // Calculate remaining time to reach minimum loading time
                        const elapsed = Date.now() - startTime;
                        const remainingTime = Math.max(0, minLoadingTime - elapsed);
                        
                        // Wait for remaining time before showing results
                        await new Promise(resolve => setTimeout(resolve, remainingTime));
                        
                        // Clear the content div and create new structure
                        content.innerHTML = '';
                        
                        // Create coordinates line
                        const coordsLine = document.createElement('p');
                        coordsLine.textContent = `${data.latitude.toFixed(4)}째N, ${data.longitude.toFixed(4)}째W`;
                        coordsLine.style.opacity = '0';
                        coordsLine.style.transition = 'opacity 1s ease-in';
                        content.appendChild(coordsLine);
                        
                        // Create city/state line
                        const cityLine = document.createElement('p');
                        cityLine.className = 'italic';
                        cityLine.textContent = `${data.city}, ${data.region}`;
                        cityLine.style.opacity = '0';
                        cityLine.style.transition = 'opacity 1s ease-in';
                        cityLine.style.transitionDelay = '0.3s';
                        content.appendChild(cityLine);
                        
                        // Create email line
                        const newEmailLine = document.createElement('p');
                        const newEmailLink = document.createElement('span');
                        newEmailLink.id = 'emailLink';
                        newEmailLink.textContent = 'E-Mail';
                        newEmailLink.style.cursor = 'pointer';
                        newEmailLink.style.opacity = '0';
                        newEmailLink.style.transition = 'opacity 1s ease-in';
                        newEmailLink.style.transitionDelay = '0.6s';
                        newEmailLine.appendChild(newEmailLink);
                        content.appendChild(newEmailLine);
                        
                        // Trigger fade in
                        setTimeout(() => {
                            coordsLine.style.opacity = '1';
                            cityLine.style.opacity = '1';
                            newEmailLink.style.opacity = '1';
                        }, 100);
                        
                        // Re-attach email click handler to new element
                        newEmailLink.addEventListener('click', emailClickHandler);
                        
                        locationClicked = false;
                        return;
                    }
                } catch (e) {
                    console.log('ipapi.co failed');
                }
                
                // If all fail, revert
                locationLine.textContent = originalText;
                locationLine.style.fontStyle = 'italic';
                document.getElementById('line1').style.opacity = '1';
                document.getElementById('line3').style.opacity = '1';
                locationClicked = false;
                
            } catch (error) {
                console.error('Location detection failed:', error);
                locationLine.textContent = originalText;
                locationLine.style.fontStyle = 'italic';
                document.getElementById('line1').style.opacity = '1';
                document.getElementById('line3').style.opacity = '1';
                locationClicked = false;
            }
        });
    </script>
</body>
</html>
